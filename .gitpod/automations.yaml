tasks:
    build-ui:
        name: Build UI
        command: |
            echo "Building AuraOS UI..."
            cd packages/ui
            rm -rf dist
            npx vite build
            echo "✅ UI build complete"
        triggeredBy:
        - manual

    auto-deploy:
        name: Auto Deploy & Push
        command: |
            echo "🚀 Auto Deploy & Push"
            
            # Check if Firebase token is set
            if [ -z "$FIREBASE_TOKEN" ]; then
                echo "❌ FIREBASE_TOKEN not set"
                exit 1
            fi
            
            # Run auto-deploy script
            ./scripts/auto-deploy.sh "chore: automated deployment"
        triggeredBy:
        - manual
        - onFileChange:
            patterns:
            - "packages/ui/src/**/*.{ts,tsx,js,jsx}"
            - "packages/core/src/**/*.{ts,tsx,js,jsx}"
            - "firestore.rules"
            - "firebase.json"

    deploy-firebase:
        name: Deploy to Firebase
        command: |
            echo "Deploying to Firebase Hosting..."
            
            # Check if FIREBASE_TOKEN is set
            if [ -z "$FIREBASE_TOKEN" ]; then
                echo "❌ Error: FIREBASE_TOKEN environment variable is not set"
                echo "Please set it in Gitpod settings: https://gitpod.io/user/variables"
                echo "Generate token with: firebase login:ci"
                exit 1
            fi
            
            # Build UI first
            echo "Building UI..."
            cd packages/ui
            rm -rf dist
            npx vite build
            cd ../..
            
            # Deploy to Firebase
            echo "Deploying to Firebase..."
            firebase deploy --only hosting,firestore:rules --token "$FIREBASE_TOKEN"
            
            echo "✅ Deployment complete!"
            echo "🌐 Your app is live at: https://adept-student-469614-k2.web.app"
        triggeredBy:
        - manual

services:
    ui-dev:
        name: UI Development Server
        description: Vite development server for AuraOS UI
        commands:
            start: |
                cd packages/ui
                npm run dev -- --host 0.0.0.0 --port 3000
            ready: |
                curl -f http://localhost:3000 > /dev/null 2>&1
        triggeredBy:
            - manual

